<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{% block title %}VN News{% endblock %}</title>
  <style>
    :root{
      --bg:#0e1116; --card:#161a22; --muted:#8a94a7; --text:#e6ebf5;
      --ring:#263247; --border:#1f2530;
      --btn-bg:#1b2432; --btn-fg:#e6ebf5; --btn-br:#2a3243;
      --btn-bg-primary:#3b82f6; --btn-fg-primary:#fff; --btn-br-primary:#3b82f6;
      --chip-bg:#1b2432;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);
      font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue","Noto Sans",Arial}
    a{color:var(--text);text-decoration:none}
    a:hover{color:#fff}
    .container{max-width:1100px;margin:0 auto;padding:24px}

    /* ===== Header: 3 cột cố định ===== */
    .header{
      display:grid;
      grid-template-columns:160px 1fr auto;
      gap:14px;
      align-items:center;
      margin-bottom:16px;
    }
    .brand{font-weight:800;font-size:22px;color:#7cc0ff}

    .search{min-width:0}
    .search form{display:flex;gap:8px;align-items:center;width:100%}
    .input,.select{
      padding:12px 14px;border-radius:12px;border:1px solid var(--ring);
      background:var(--card);color:var(--text);outline:0;font-size:15px
    }
    .input{flex:1;min-width:0}
    .select{max-width:170px;appearance:none}

    /* ===== Actions (hàng ngang) + Stack (cột dọc) ===== */
    .actions{
      display:flex;
      gap:10px;
      align-items:flex-start;   /* để cụm stack đứng vững khi cao hơn các nút khác */
      flex-wrap:wrap;           /* khi hẹp thì tự xuống dòng */
      justify-content:flex-end;
    }
    .actions .stack{
      display:flex;
      flex-direction:column;    /* Đăng bài ở trên, Admin ở dưới */
      gap:8px;
    }

    /* Buttons */
    .btn{
      display:inline-flex;align-items:center;justify-content:center;gap:8px;
      height:40px;padding:0 16px;border-radius:12px;border:1px solid var(--btn-br);
      background:var(--btn-bg);color:var(--btn-fg);font-weight:700;white-space:nowrap;
      cursor:pointer;min-width:120px;transition:transform .04s,border-color .15s,background .15s
    }
    .btn:hover{border-color:var(--ring)}
    .btn:active{transform:translateY(1px)}
    .btn--primary{background:var(--btn-bg-primary);border-color:var(--btn-br-primary);color:var(--btn-fg-primary)}
    .btn--ghost{background:transparent}

    /* ===== Chips cuộn ngang ===== */
    .nav-wrap{padding-top:2px}
    .nav-scroll{display:flex;gap:10px;overflow-x:auto;padding-bottom:6px;scrollbar-width:thin}
    .nav-scroll::-webkit-scrollbar{height:6px}
    .nav-scroll::-webkit-scrollbar-thumb{background:#2b3446;border-radius:4px}
    .chip{
      display:inline-flex;align-items:center;justify-content:center;padding:8px 12px;height:34px;border-radius:999px;
      border:1px solid var(--border);background:var(--chip-bg);color:var(--text);font-size:13px;flex:0 0 auto
    }
    .chip:hover{border-color:var(--ring)}

    /* ===== Lưới cards ===== */
    .grid.cards{display:grid;gap:16px}
    .grid.cards{grid-template-columns:repeat(1,minmax(0,1fr))}
    @media(min-width:700px){.grid.cards{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media(min-width:1024px){.grid.cards{grid-template-columns:repeat(3,minmax(0,1fr))}}

    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden;display:flex;flex-direction:column}
    .card .thumb{width:100%;height:220px;object-fit:cover;display:block;background:#0b0f15}
    .card .thumb--empty{width:100%;height:220px;background:#0b0f15;color:#667;display:flex;align-items:center;justify-content:center}
    .card .pad{padding:14px}
    .card .title{
      margin:8px 0 6px;font-weight:800;font-size:18px;line-height:1.35;
      display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden
    }
    .card .excerpt{
      color:var(--text);opacity:.85;font-size:15px;display:-webkit-box;
      -webkit-line-clamp:4;-webkit-box-orient:vertical;overflow:hidden
    }
    .card .meta{margin-top:10px;color:var(--muted);font-size:13px}

    @supports not (-webkit-line-clamp: 2) {
      .card .title{max-height:48px;overflow:hidden}
      .card .excerpt{max-height:96px;overflow:hidden}
    }

    /* ===== Responsive nhỏ ===== */
    @media (max-width:720px){
      .header{grid-template-columns:1fr;gap:12px}
      .brand{font-size:20px}
      .select{max-width:unset}
      .btn{min-width:unset}
      .actions{justify-content:flex-start}
    }
  </style>
  {% block extra_head %}{% endblock %}
</head>
<body>
  <header class="container header">
    <a class="brand" href="{% url 'home' %}">VN News</a>

    <div class="search">
      <form method="get" action="{% url 'home' %}">
        <input class="input" name="q" value="{{ request.GET.q|default:'' }}" placeholder="Tìm bài..." />
        <select class="select" name="origin">
          <option value="" {% if not request.GET.origin %}selected{% endif %}>-- Tất cả nguồn --</option>
          <option value="user" {% if request.GET.origin == 'user' %}selected{% endif %}>User</option>
          <option value="crawler" {% if request.GET.origin == 'crawler' %}selected{% endif %}>Crawler</option>
        </select>
        <select class="select" name="sort">
          <option value="new" {% if request.GET.sort|default:'new' == 'new' %}selected{% endif %}>Mới nhất</option>
          <option value="old" {% if request.GET.sort == 'old' %}selected{% endif %}>Cũ nhất</option>
        </select>
        <button class="btn btn--primary" type="submit">Lọc</button>
      </form>
    </div>

    <div class="actions">
      {% if request.user.is_authenticated %}

        <!-- CỤM 2 NÚT XẾP DỌC -->
        <div class="stack">
          <a class="btn" href="{% url 'submit_article' %}">Đăng bài</a>
          {% if request.user.is_staff or request.user.is_superuser %}
            <a class="btn" href="{% url 'admin_articles' %}">Admin</a>
          {% endif %}
        </div>

        <!-- Các nút khác vẫn nằm hàng ngang -->
        <a class="btn" href="{% url 'my_articles' %}">Bài của tôi</a>
        <a class="btn btn--ghost" href="{% url 'logout' %}">Đăng xuất</a>

      {% else %}
        <a class="btn btn--primary" href="{% url 'login' %}">Đăng nhập</a>
        <a class="btn" href="{% url 'register' %}">Đăng ký</a>
      {% endif %}
    </div>
  </header>

  <nav class="container nav-wrap">
    {% if categories %}
      <div class="nav-scroll">
        <a class="chip" href="{% url 'home' %}">Tất cả</a>
        {% for c in categories %}
          <a class="chip" href="{% url 'category' slug=c.slug %}">{{ c.name }}</a>
        {% endfor %}
      </div>
    {% endif %}
  </nav>

  <main class="container">
    {% block content %}{% endblock %}
  </main>

  <footer class="container" style="margin:40px 0 24px;color:var(--muted);text-align:center">
    © VN News
  </footer>

  {% block extra_scripts %}{% endblock %}
</body>
</html>
