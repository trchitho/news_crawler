{% extends "base.html" %}
{% block title %}Qu·∫£n tr·ªã b√†i vi·∫øt{% endblock %}

{% block content %}
<h2 style="margin:6px 0 12px">Qu·∫£n tr·ªã b√†i vi·∫øt</h2>

<form method="get" style="display:flex;gap:8px;margin-bottom:10px">
  <input name="q" value="{{ q }}" placeholder="T√¨m ti√™u ƒë·ªÅ, m√¥ t·∫£..." style="flex:1;padding:8px;border-radius:8px;border:1px solid var(--border);background:var(--card);color:var(--text)">
  <select name="origin" style="padding:8px;border-radius:8px;border:1px solid var(--border);background:var(--card);color:var(--text)">
    <option value="">-- T·∫•t c·∫£ ngu·ªìn --</option>
    <option value="user" {% if origin == "user" %}selected{% endif %}>User</option>
    <option value="crawler" {% if origin == "crawler" %}selected{% endif %}>Crawler</option>
  </select>
  <button class="btn" type="submit">L·ªçc</button>
  <form method="post" action="{% url 'admin_crawl_now' %}" style="margin-left:auto">
    {% csrf_token %}
    <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-bottom:14px">
      <!-- L·ªçc ngu·ªìn s·∫µn c√≥ c·ªßa b·∫°n ... -->

      <form method="post" action="{% url 'admin_crawl_now' %}">
        {% csrf_token %}
        <button type="submit" class="btn btn--primary">
          <span style="margin-right:6px">üîÑ</span> C·∫≠p nh·∫≠t (crawl)
        </button>
      </form>
    </div>

  </form>
</form>

<div class="card" style="overflow:auto">
  <table style="width:100%;border-collapse:collapse">
    <thead>
      <tr class="muted" style="text-align:left">
        <th style="padding:10px">Ti√™u ƒë·ªÅ</th>
        <th>Ngu·ªìn</th>
        <th>T√°c gi·∫£ (email)</th>
        <th>ƒêƒÉng l√∫c</th>
        <th style="width:180px">Thao t√°c</th>
      </tr>
    </thead>
    <tbody>
    {% for a in page_obj %}
      <tr style="border-top:1px solid var(--border)">
        <td style="padding:8px">
          <a href="{% url 'article_detail' a.slug %}" target="_blank">{{ a.title|default:"(kh√¥ng ti√™u ƒë·ªÅ)" }}</a>
        </td>
        <td style="padding:8px">{{ a.origin }}</td>
        <td style="padding:8px">
          {% if a.author %}
            {{ a.author.get_full_name|default:a.author.username }}
            <span class="muted">({{ a.author.email|default:"‚Äî" }})</span>
          {% else %}
            <span class="muted">‚Äî</span>
          {% endif %}
        </td>
        <td style="padding:8px">{{ a.published_at|date:"H:i d/m/Y" }}</td>
        <td style="padding:8px;display:flex;gap:6px">
          {% if a.origin == "user" %}
            <a class="btn" href="{% url 'admin_article_edit' a.id %}">S·ª≠a</a>
          {% else %}
            <span class="muted" title="B√†i crawler ch·ªâ c√≥ th·ªÉ xo√°">Kh√¥ng s·ª≠a</span>
          {% endif %}
          <form method="post" action="{% url 'admin_article_delete' a.id %}" onsubmit="return confirm('Xo√° b√†i n√†y?')">
            {% csrf_token %}
            <button class="btn" type="submit">Xo√°</button>
          </form>
        </td>
      </tr>
    {% empty %}
      <tr><td colspan="5" style="padding:12px">Kh√¥ng c√≥ b√†i.</td></tr>
    {% endfor %}
    </tbody>
  </table>
</div>

{% if page_obj.paginator.num_pages > 1 %}
  <div style="display:flex;gap:10px;justify-content:center;margin-top:14px">
    {% if page_obj.has_previous %}
      <a class="btn" href="?q={{ q }}&origin={{ origin }}&page={{ page_obj.previous_page_number }}">‚Üê Tr∆∞·ªõc</a>
    {% endif %}
    <span class="muted" style="align-self:center">Trang {{ page_obj.number }}/{{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}
      <a class="btn" href="?q={{ q }}&origin={{ origin }}&page={{ page_obj.next_page_number }}">Sau ‚Üí</a>
    {% endif %}
  </div>
{% endif %}
{% endblock %}
